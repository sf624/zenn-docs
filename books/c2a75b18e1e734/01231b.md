---
title: "位置姿勢（ポーズ）とは何か。そしてSE(3)って何？"
free: false
---

この記事を読むと

- 位置姿勢（ポーズ）とは何か
- 位置姿勢（ポーズ）を取り扱うときに出てくる$SE(3)$や$SO(3)$といった用語は何なのか
- 位置姿勢（ポーズ）はなぜ群論と関係があるのか

これらの事柄について理解できます。

# はじめに

移動体（カメラ、ロボット、ドローン、自動車、航空機、etc.）の位置姿勢を表現し、合成や補間の演算をすることは一つの重要な技術である。しかしながら、この分野をいざ調べてみようとすると、やれリー群・リー代数がなんだとか、$\mathrm{SE}(3)$や$\mathfrak{se}(3)$がなんだとか、指数写像(Expmap)・対数写像(Logmap)による補完がどうだとか、などなど見慣れない数学的用語が当たり前のごとく登場し、工学初学者がこの分野に入っていく上での心理的なハードルが高い。

この記事では、そもそも位置姿勢（ポーズ）とは一体何なのかというところから始め、それを表現する数学的な道具の自然な帰結として、$\mathrm{SE}(3)$といった（リー）群にたどり着くことを説明する。リー代数を含め指数写像や対数写像については別の記事で将来的に説明をしていきたいが、ここまで来ればあとは他の良質な文献を参考にして何を言っているのか理解できると思われる。前提知識としては、大学初年度程度の行列に関する知識程度である。

# 位置姿勢（ポーズ）の表現方法

どのような数学的表現で以て位置・姿勢と我々は呼ぶのか、基礎的な部分であるが非常に重要な部分であるのでここから始める。

簡単な例として2次元平面上でのロボットの運動を考える。静止した座標系をグローバル座標(Global frame)、ロボットに固定された動的な座標系をローカル座標(Local frame)と呼ぶことにする[^global]。

[^global]: グローバル座標の例としては、１．地図上に定義された座標（マップ座標）、２．地球に固定された座標（例えば[ECEF][ECEF]座標）、３．地球に固定されない更に純粋な慣性系に近い座標（例えば[ECI][ECI]座標）、などがあり「静止」しているという定義は文脈によって異なる。

[ECEF]: https://en.wikipedia.org/wiki/Earth-centered,_Earth-fixed_coordinate_system
[ECI]: https://en.wikipedia.org/wiki/Earth-centered_inertial

ローカル座標がグローバル座標と一致していたとして、そこからロボットがx-y座標で$\begin{bmatrix}a\\b\end{bmatrix}$移動して、その後に$\theta$だけ反時計回りに回転したと仮定する。このロボットの（元の位置から見たときの）位置と姿勢は何かしらの方法で表現したい。

## 素朴なポーズ表現

まず、素朴な着想としては登場した三つの数値をシンプルに並べて、

$$
p = \begin{bmatrix} a \\ b \\ \theta \end{bmatrix}
$$

のように位置姿勢表現とするということが考えられる。pは、pose（位置姿勢）の頭文字であり、空間におけるposition（位置）とorientation（姿勢）の組み合わせとして用語が定義されている。姿勢と言った場合は回転のみを表すため注意する。以後、「位置姿勢」ではなく一般的にこの業界で使われている「ポーズ」を用いて話を進める。

さて、この表現はロボットの運動をそのまま表したもので直観的であるものの応用が利きにくい。

たとえば、ここから更に**相対的に**ロボットが$\Delta p = \begin{pmatrix} \Delta a \\ \Delta b \\ \Delta \theta \end{pmatrix}$に相当する運動をしたと仮定する。この場合、結果としての（グローバル座標から見た）ポーズはどうなるだろうか。

答えは、

$$
p_{new} = \begin{bmatrix}a_{new}\\ b_{new}\\ \theta_{new}\end{bmatrix} = \begin{bmatrix} a + \Delta a\cos\theta - \Delta b \sin\theta \\ b + \Delta a \sin\theta + \Delta b \cos\theta \\ \theta + \Delta \theta \end{bmatrix}
$$

となる。当然ながら、$p_{new} = p + \Delta p$のような単純なベクトル和の関係にはなく、またこれまで慣れ親しんできた演算体系でもない。更に、二次元の場合は回転角については和を取るだけで良かったが、三次元の場合はそんなことも成り立たずより状況が複雑化してくる。

我々は上記で行ったようなポーズの合成演算の他に、ポーズの逆ポーズや、ポーズのべき乗（例えば$p$の半分の移動に相当する$p^{1/2}$の演算）、などの概念を導入して柔軟なポーズの演算を実施したい。従って、このようなロボットの内的な運動から着想を得たポーズの表現方法には限界がある。

## 座標変換として見たポーズ表現

ここで発想を逆にする。任意の**静止している点**のグローバル座標系での座標を$x_{global} \in \mathbb{R}^2$とし、移動後のロボットから見た**同じ点**のローカル座標系での座標を$x_{local} \in \mathbb{R}^2$と置く。この両者にはどのような等式が成り立つだろうか。

これは、よく慣れ親しんだ内容である。先ほどの三つのポーズを表すパラメータ$(a, b, \theta)$から回転行列$R(\theta)=\begin{bmatrix}\cos\theta&-\sin\theta\\\sin\theta&\cos\theta\end{bmatrix}$と平行移動ベクトル$\,t=\begin{bmatrix}a\\b\end{bmatrix}$を用意すると、以下の等式が成立する。

$$
x_{global} =R\, x_{local} + t
$$

$R$や$t$が右辺（$x_{local}$側）に来ていることに注意してほしい。このことから、移動体のポーズというのは**ローカル座標系からグローバル座標系への座標変換**と等価とみることができる。

ところで、まだ$(R, t)$の2つの数値を別個に取り扱わなければならない。これらを統一した表現方法がないかを検討すると、

$$
\begin{bmatrix}x_{global}\\ 1 \end{bmatrix} = \begin{bmatrix} R & t\\ 0 & 1 \end{bmatrix} \begin{bmatrix} x_{local} \\ 1 \end{bmatrix}
$$

が成立することが分かる。

$\begin{bmatrix} R & t\\ 0 & 1 \end{bmatrix}$はブロック分割による表現を使っており、成分表示すれば$\begin{bmatrix} \cos\theta & -sin\theta & a \\ \sin\theta & \cos\theta & b \\ 0 & 0 & 1 \end{bmatrix}$である。

この行列$\begin{bmatrix} R & t\\ 0 & 1 \end{bmatrix}$をロボットのポーズの表現であるとして、$T$と置くことにしよう。また$x_{global}$と$x_{local}$には、1の成分が下に追加されたが、これは同次座標(homogenerous coordinate)と呼ばれるものである。$T$は、ローカル同次座標からグローバル同次座標への座標変換を表現する行列ということになる。

この表現は非常に応用が利く。なぜなら、行列そのものやその演算は我々が良く慣れ親しんだものであり、行列について成立した様々な性質をそのまま応用可能だからである。

たとえば、ポーズ$T_1$から**相対的に**ポーズ$T_2$に相当する運動をしたあとのポーズ$T_3$はどのようになるだろうか。

ポーズ$T_1$のときのローカル座標を$x_{local:1}$、ポーズ$T_3$のときのローカル座標を$x_{local:3}$としよう。このとき、$T_2$は$x_{local:1}$をグローバル座標、$x_{local:3}$をローカル座標として見たときの座標変換であるということになる。

$$
x_{local:1} = T_2 x_{local:3}
$$

従って、

$$
x_{global} = T_1 x_{local:1} = T_1 T_2 x_{local:3} = T_3 x_{local:3}
$$

が成立しなければならないので、$T_3 = T_1 T_2$である。ポーズの合成は、行列積という演算と等価であると見なすことができる。

次に、ポーズが$T$であるとき**逆に**ローカル座標から見たグローバル座標のポーズ$T_2$はどうなるか？

$$
T_2 x_{global} = x_{local} = T_1^{-1} x_{global}
$$

が成立しなければならないので、$T_2 = T_1^{-1}$である。ポーズの逆演算は、逆行列の演算と等価であると見なすことができる。

さらに、ポーズが$T_1$に至るまでに、同じポーズ$T_2$を2回実施したとすると、$T_2$はどのようにして求められるだろうか。

$$
x_{global} = T_1 x_{local} = T_2 T_2 x_{local}
$$

であるので、$T_1 = T_2^2$であり、従って$T_2 = T_1^{1/2}$である。行列のべき乗は、一般には例えばジョルダン標準形などによって求めることができる[^expmap]。このようにポーズの半分のポーズといった操作は、行列のべき乗の演算であると見なすことができる。

[^expmap]: ただし、リー群の場合はリー代数を通した指数写像・対数写像によって求めることが一般的である。

以上のように、これまでの行列に関する知識体系をそのままポーズの様々な演算に応用可能である。

この$T$の集合は、$\mathrm{SE}(2)$ (SE: Special Euclidian group)と呼ばれるものであり、ユークリッド群(Euclidian group)と呼ばれるものの一つである。また、回転変換のみを実施する$R$単品の集合は$\mathrm{SO}(2)$ (SO: Special orthogonal group)、平行移動変換のみを実施する$t$単品の集合は$\mathrm{T}(2)$ (T: Translation group)と呼ばれるものであり$\mathbb{R}^2$と等価である。

実は、この話は三次元でも全く同じであり、三次元の回転を表す回転行列$R$と平行移動ベクトル$t$を用意すれば、同じ規則が成り立つ。以下に、表でまとめる。

| 群の名称| 群の要素 | 合成演算 | 座標変換 | ポーズとしての意味 |
|-|-|-|-|-|
| $\mathrm{T}(2)$ | $T = t \in \mathbb{R^2}$ | $T_3 = T_1 + T_2$ | $x_{global} = T + x_{local}$ | 2次元の平行移動 |
| $\mathrm{SO}(2)$ | $T = R$ (2×2直交行列) | $T_3 = T_1 T_2$ | $x_{global} = T x_{local}$ | 2次元の回転 |
| $\mathrm{SE}(2)$ | $T = \begin{bmatrix} R & t\\ 0 & 1 \end{bmatrix}$  | $T_3 = T_1 T_2$ | $\begin{bmatrix}x_{global}\\1\end{bmatrix} = T \begin{bmatrix}x_{local}\\1\end{bmatrix}$ | 2次元の剛体運動 |
| $\mathrm{T}(3)$ | $T = t \in \mathbb{R^3}$ | $T_3 = T_1 + T_2$ | $x_{global} = T + x_{local}$ | 3次元の平行移動 |
| $\mathrm{SO}(3)$ | $T = R$ (3×3直交行列) | $T_3 = T_1 T_2$ | $x_{global} = T x_{local}$ | 3次元の回転 |
| $\mathrm{SE}(3)$ | $T = \begin{bmatrix} R & t\\ 0 & 1 \end{bmatrix}$  | $T_3 = T_1 T_2$ | $\begin{bmatrix}x_{global}\\1\end{bmatrix} = T \begin{bmatrix}x_{local}\\1\end{bmatrix}$ | 3次元の剛体運動 |


# （リー）群とは何なのか

ところで、$\mathrm{SE}(2)$や$\mathrm{SO}(2)$などは「群」であるのだが、群とはなんだろうか。先ほどの、$\mathrm{SE}(2)$を例にして話を展開する。

$\mathrm{SE}(2)$には、以下のような性質がある。

１．任意の2つのポーズに対して、ポーズの合成が行列積として演算され、その結果もポーズである。

$$
\forall T_1, T_2 \in \mathrm{SE}(2),\, T_1 T_2 \in \mathrm{SE}(2)
$$

２．3つ以上のポーズを合成することもできる。この場合、一般に行列積は結合法則を満たすことから、ポーズの合成も結合法則を満たす。

$$
\forall T_1, T_2, T_3 \in \mathrm{SE}(2),\, T_1 (T_2 T_3) = (T_1 T_2) T_3
$$

３．全く動かない、グローバル座標と同一のポーズ（つまり$T=I$ ($I$は単位行列)）もポーズの一つである。これは、他のポーズと合成した場合に同じポーズを返す。

$$
\exists I \in \mathrm{SE}(2),\, \forall T \in \mathrm{SE}(2),\, T I = I T = T 
$$

４．任意のポーズに対して逆演算に相当するポーズが存在し、これは元のポーズに対する逆行列である。これもポーズである。

$$
\forall T \in \mathrm{SE}(2), \exists T^{-1} \in \mathrm{SE}(2), T^{-1} T = T T^{-1} = I
$$

以上のように、ある集合$G$とそれに対して定義される二項演算$\mu$の組$(G,\mu)$が、１．閉性、２．結合法則、３．単位元の存在、４．逆元の存在、の4条件を満たすとき、$(G,\mu)$を「[群](https://ja.wikipedia.org/wiki/%E7%BE%A4_(%E6%95%B0%E5%AD%A6))」と呼ぶ。先ほどの例では、$G$は$\mathrm{SE}(2)$を構成する行列の集合のことであり、$\mu$とは行列積という演算のことである。なお、群そのものは座標変換に関する演算は定義される必要はなく、あくまで座標変換に関わる$\mathrm{SE}(2)$などが群に関する性質も満たすということである。

そして、先ほど述べたようにポーズの1/2乗のようなべき乗の演算も$\mathrm{SE}(2)$などでは可能であり、より小さいべき乗を取っていけば微小ポーズなるもの、つまり微分に相当する演算が存在することが分かる。このような群を特にリー群と呼ぶわけである。

# 参考文献

https://qiita.com/scomup/items/d82b35aeb1ecabd75e60

http://ethaneade.com/lie.pdf

https://naist.repo.nii.ac.jp/record/8177/files/R012616.pdf