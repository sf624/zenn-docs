---
title: "floatã®ãƒ“ãƒƒãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è¡¨ç¤ºã™ã‚‹å¯æ¬ãªC++ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¨ã¯"
emoji: "ğŸ’½"
type: "tech"
topics:
  - "cpp"
  - "c"
  - "ä½ãƒ¬ã‚¤ãƒ¤"
  - "float"
  - "å›½éš›æ¨™æº–è¦æ ¼"
published: true
published_at: "2025-07-05 00:38"
---

## ã“ã®è¨˜äº‹ã‚’èª­ã‚€ã¨â€¦

- ãƒã‚¤ãƒˆ (byte)ã€ãƒ“ãƒƒãƒˆï¼ˆbitï¼‰ã€`unsigned char`ã¨ã®é–¢ä¿‚
- ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆè¡¨ç¾ (object representation)
- å€¤è¡¨ç¾ (value representation)
- ãƒˆãƒªãƒ“ã‚¢ãƒ«ã‚³ãƒ”ãƒ¼å¯èƒ½ãªå‹ (trivially copyable type)
- `std::memcpy`ã¯ä½•ã‚’ã‚„ã£ã¦ã„ã‚‹ã®ã‹
- ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ãƒ“ãƒƒãƒˆ
- strict aliasing rule
- ã‚¨ãƒ³ãƒ‡ã‚£ã‚¢ãƒ³ (endian) / ãƒã‚¤ãƒˆã‚ªãƒ¼ãƒ€ãƒ¼ (byte order)
- å›½éš›æ¨™æº–è¦æ ¼ã¨æ…£ç¿’ã¨ã®ã‚®ãƒ£ãƒƒãƒ—

ã“ã‚Œã‚‰ã®äº‹æŸ„ã«ã¤ã„ã¦ã€ç†è§£ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

## ã¯ã˜ã‚ã«

IEEE 754 binary32[^binary32]ã§å®Ÿè£…ã•ã‚ŒãŸ`float`ã®ãƒ“ãƒƒãƒˆè¡¨ç¾ã‚’å‡ºåŠ›ã™ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ä½œæˆã—ãŸã„ã€‚è«–ç†ï¼†æ¼”ç®—ã«ã‚ˆã£ã¦ãƒ“ãƒƒãƒˆã‚’å‡ºåŠ›ã™ã‚‹ãŒã€ä»Šå›ã¯è©±ã®éƒ½åˆä¸Š`unsigned int`ãŒ`float`ã¨åŒã˜ãƒã‚¤ãƒˆæ•°ã§ã‚ã‚Šã€ã“ã‚Œã‚’ä½¿ç”¨ã™ã‚‹ã¨ä»®å®šã™ã‚‹ã€‚

[^binary32]: è©³ã—ãã¯ä»¥å‰ã®è¨˜äº‹å‚ç…§ï¼š https://zenn.dev/misokatsu6/articles/e753e1a072c049

è§£ç­”ã®ä¸€ã¤ã¨ã—ã¦ã€ä¸‹è¨˜ã®ã‚ˆã†ãªã‚‚ã®ãŒè€ƒãˆã‚‰ã‚Œã‚‹ã€‚

```cpp
#include <iostream>
#include <cstring>
#include <cstdint>
#include <climits>
#include <limits>

static_assert(sizeof(float) * CHAR_BIT == 32);
static_assert(std::numeric_limits<float>::is_iec559);
static_assert(std::numeric_limits<float>::digits == 24);
static_assert(std::numeric_limits<float>::radix == 2);
static_assert(std::numeric_limits<float>::max_exponent == 128);

int main() {
  float x = 1.0f;
  std::uint32_t buf;
  std::memcpy(&buf, &x, sizeof(float));
  for (int i = 31; i >= 0; i--) {
    std::cout << ((buf & (1U << i)) ? '1' : '0');
    if (i == 31 || i == 23) {
        std::cout << ' ';
    }
  }
  std::cout << "\n";
}
```

`float`ã¨åŒã˜å¤§ãã•ã®`uint32_t`ã«å†…å®¹ã‚’`memcpy`ã§ã‚³ãƒ”ãƒ¼ã—ã¦ã€ã‚ã¨ã¯ãƒ“ãƒƒãƒˆæ¼”ç®—ã‚’æ–½ã™ã“ã¨ã§ãƒ“ãƒƒãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è¡¨ç¤ºã™ã‚‹ã¨ã„ã†ã‚‚ã®ã§ã‚ã‚Šã€[å®Ÿè¡Œçµæœ][result]ã¯ä¸‹è¨˜ã®ã‚ˆã†ã«ãªã‚‹ã¯ãšã§ã‚ã‚‹ã€‚

```sh
0 01111111 00000000000000000000000
```

ã“ã®ã‚ˆã†ãªãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«ã‚ˆã£ã¦ã€`float`(binary32)ã®ãƒ“ãƒƒãƒˆè¡¨ç¾ã‚’å¾—ã‚‹ã“ã¨ãŒã§ããŸãŒã€ã“ã‚Œã¯ãŸã¾ãŸã¾ä¸Šæ‰‹ãã„ã£ãŸã ã‘ãªã®ã ã‚ã†ã‹ã€‚ãªãœ`std::memcpy`ã‚’ã™ã‚Œã°ã€`float`ã®ãƒ“ãƒƒãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ãŒãã®ã¾ã¾`uint32_t`ã«è»¢å†™ã§ããŸã®ã ã‚ã†ã‹ã€‚`float`ã‚„`uint32_t`ã§ã¯ãªãã¦ã€ä»–ã®å‹ã§ã‚‚åŒã˜ã“ã¨ãŒã§ãã‚‹ã®ã ã‚ã†ã‹ã€‚

ã“ã®æ‰‹ã®ãƒ¡ãƒ¢ãƒªå‘¨ã‚Šã‚’ç›´æ¥æ“ä½œã™ã‚‹è©±ã¯è‰²ã€…ã¨è½ã¨ã—ç©´ãŒã‚ã‚‹ã€‚ã“ã®ã‚ãŸã‚Šã®ç†è§£ãŒã‚ã‚„ãµã‚„ã«ãªã‚ŠãŒã¡ã ãŒå¤§äº‹ãªC/C++ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®åŸºç¤çš„ãªéƒ¨åˆ†ã‚’ã€å›½éš›æ¨™æº–è¦æ ¼ã«æ›¸ã‹ã‚ŒãŸå†…å®¹ã‹ã‚‰ä¸å¯§ã«ç¢ºèªã—ã¦ã„ãã€‚ã“ã®ã‚ˆã†ãªä¸€è¦‹ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§ã‚ã£ã¦ã‚‚æ­£ç¢ºã«ç†è§£ã™ã‚‹ã«ã¯å¤šå°‘ã®åˆ†é‡ãŒå¿…è¦ã¨ãªã‚‹ã€‚

å‚ç…§å…ˆã¨ã—ã¦ã€ä»Šå›ã¯C++14ã®å›½éš›æ¨™æº–è¦æ ¼ã®æœ€çµ‚ãƒ‰ãƒ©ãƒ•ãƒˆ[n4140](https://timsong-cpp.github.io/cppwp/n4140)ã‚’ä½¿ç”¨ã™ã‚‹ã€‚ã¾ãŸC++ã¯Cã«åŸºã¥ãã“ã¨ã‹ã‚‰ã€C++14ã®"normative reference"ã§ã‚ã‚‹C99ã®æœ€çµ‚ãƒ‰ãƒ©ãƒ•ãƒˆ[n1256](https://www.open-std.org/jtc1/sc22/wg14/www/docs/n1256.pdf)ã‚’ä½¿ç”¨ã™ã‚‹ã€‚

C++ã®è¨€èªè¦æ ¼ã«ãŠã„ã¦å›ºæœ‰ã®æ„å‘³åˆã„ã‚’æŒã¤ç”¨èªã«ã¤ã„ã¦ã¯ã€åˆå‡ºæ™‚ã«ã¯ã‚¤ã‚¿ãƒªãƒƒã‚¯ä½“ã¨æ—¥æœ¬èªè¨³ã§ã€Œ*object*ï¼ˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼‰ã€ã®ã‚ˆã†ã«è¡¨ç¾ã—ã€æ—¥å¸¸ç”¨èªã§ã¯ãªã„ã“ã¨ã‚’åˆ†ã‹ã‚‹ã‚ˆã†ã«è¨˜è¼‰ã™ã‚‹ã€‚äºŒå›ç›®ä»¥é™ã¯ã€æ—¥æœ¬èªè¨³ã‚’ãã®ã¾ã¾æ›¸ããŸã‚æ³¨æ„ã•ã‚ŒãŸã„ã€‚ã¾ãŸã€ä»Šå›ã®è§£èª¬ã«å¿…è¦ãªå†…å®¹ã«çµã£ã¦å¼•ç”¨ã—ã€ç´°ã‹ã„ä¾‹å¤–ãªã©ã«ã¤ã„ã¦ã¯è¨˜è¿°ãŒç…©é›‘ã¨ãªã‚‹ãŸã‚çœç•¥ã™ã‚‹ã€‚è„šæ³¨ã«ã¤ã„ã¦ã‚‚ã€ã‚ã‚ã›ã¦èª­ã‚“ã§ã‚‚ã‚‰ã†ã¨ç†è§£ãŒæ·±ã¾ã‚‹ã¨è€ƒãˆã‚‹ã€‚

## ãƒ¡ãƒ¢ãƒªã¨ã¯ä½•ã‹

ã¾ãšã€å¤‰æ•°ã‚’æ ¼ç´ã—ã¦ã„ã‚‹ãƒ¡ãƒ¢ãƒªã¨ã¯C/C++ã§ã¯ã©ã®ã‚ˆã†ã«ä½ç½®ã¥ã‘ã‚‰ã‚Œã¦ã„ã‚‹ã®ã‹ã€ã“ã“ã‹ã‚‰ç¢ºèªã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚

[[intro.memory]](https://timsong-cpp.github.io/cppwp/n4140/intro.memory) ã«ã¯ã“ã®ã‚ˆã†ãªè¨˜è¼‰ãŒã‚ã‚‹ã€‚

- ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®åŸºæœ¬å˜ä½ã¯*byte*ï¼ˆãƒã‚¤ãƒˆï¼‰ã¨å‘¼ã¶ã€‚
- ãƒã‚¤ãƒˆã¯ã€å°‘ãªãã¨ã‚‚UTF-8ã®8ãƒ“ãƒƒãƒˆã‚³ãƒ¼ãƒ‰ãƒ¦ãƒ‹ãƒƒãƒˆã‚’æ ¼ç´ã§ãã‚‹å¤§ãã•ã§ãªã‘ã‚Œã°ãªã‚‰ãªã„ã€‚
- ãƒã‚¤ãƒˆã¯ã€é€£ç¶šã—ãŸãƒ“ãƒƒãƒˆã«ã‚ˆã£ã¦æ§‹æˆã•ã‚Œã€ãã®ãƒ“ãƒƒãƒˆæ•°ã¯å‡¦ç†ç³»å®šç¾©[^1]ã§ã‚ã‚‹ã€‚
- ãƒã‚¤ãƒˆã¯ã€ãã‚Œãã‚Œå›ºæœ‰ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æŒã¤ã€‚

ãƒ¡ãƒ¢ãƒªã¯ãã‚Œãã‚ŒãŒã‚¢ãƒ‰ãƒ¬ã‚¹ã§ç‰¹å®šã§ãã‚‹ãƒã‚¤ãƒˆã‹ã‚‰æ§‹æˆã•ã‚Œã¦ã€1ãƒã‚¤ãƒˆã¯ã„ãã¤ã‹ã®ãƒ“ãƒƒãƒˆã«ã‚ˆã£ã¦æ§‹æˆã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã§ã‚ã‚‹ã€‚ãã—ã¦1ãƒã‚¤ãƒˆã¯8ãƒ“ãƒƒãƒˆã‚³ãƒ¼ãƒ‰ãƒ¦ãƒ‹ãƒƒãƒˆã‚’æ ¼ç´ã§ãã‚‹ã®ã§ã€å°‘ãªãã¨ã‚‚8bitã§ã‚ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚‹ã€‚

[^1]: å¾“ã£ã¦ã€ãƒã‚¤ãƒˆã¯8bitã§ã¯ãªãã€ä¾‹ãˆã°9bitã§ã‚ã£ã¦ã‚‚ã‚ˆã„ã€‚

## ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã¯ä½•ã‹

æ¬¡ã«ã€C/C++ã«ãŠã‘ã‚‹å¤‰æ•°ãŒãã®ãƒã‚¤ãƒˆã¨ã„ã†ã‚‚ã®ã«ã©ã®ã‚ˆã†ã«æ ¼ç´ã•ã‚Œã‚‹ã®ã‹ã‚’ç¢ºèªã™ã‚‹ã€‚

[[intro.object]](https://timsong-cpp.github.io/cppwp/n4140/intro.object#1) ã«ã¯ã“ã®ã‚ˆã†ãªè¨˜è¼‰ãŒã‚ã‚‹ã€‚

- *object*ï¼ˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼‰[^object]ã¨ã¯ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®é ˜åŸŸã®ã“ã¨ã§ã‚ã‚‹ã€‚
- ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯*definition*ï¼ˆå®šç¾©ï¼‰ã«ã‚ˆã£ã¦æ§‹ç¯‰ã•ã‚Œã‚‹ã€‚
- ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯*name*ï¼ˆåå‰ï¼‰ã‚’æŒã¤ã“ã¨ãŒã§ãã‚‹[^name]ã€‚
- ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯*type*ï¼ˆå‹ï¼‰ã‚’æŒã¤ã€‚
  - *object type*ï¼ˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å‹ï¼‰ã¨ã¯ã€ãã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒæ§‹ç¯‰ã•ã‚ŒãŸå‹ã‚’æ„å‘³ã™ã‚‹ã€‚
- ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ã¯ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒå æœ‰ã™ã‚‹æœ€åˆã®ãƒã‚¤ãƒˆã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ã“ã¨ã§ã‚ã‚‹ã€‚

ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã¯ã„ã‚ã‚†ã‚‹å¤‰æ•°ã€åå‰ã¨ã„ã†ã®ã¯ã„ã‚ã‚†ã‚‹å¤‰æ•°åã®ã“ã¨ã§ã‚ã‚‹ã€‚å‰ç¯€ã¨åˆã‚ã›ã‚‹ã¨ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯åŸºæœ¬å˜ä½ã‚’ãƒã‚¤ãƒˆã¨ã—ã¦ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ä¸€éƒ¨ã‚’å æœ‰ã—ã¦ã„ã‚‹ã¨ã„ã†ã“ã¨ã«ãªã‚‹ã€‚

[^name]: é–¢æ•°ã®æˆ»ã‚Šå€¤ãªã©ã®ã‚ˆã†ã«åå‰ã‚’æŒãŸãªã„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚‚å­˜åœ¨ã™ã‚‹
[^object]: ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã§ã„ã†ã¨ã“ã‚ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ãªã„

## ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆè¡¨ç¾ã€å€¤è¡¨ç¾ã€ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ãƒ“ãƒƒãƒˆã¨ã¯ä½•ã‹

ã•ã‚‰ã«èª­ã¿é€²ã‚ã‚‹ã¨[[basic.types]](https://timsong-cpp.github.io/cppwp/n4140/basic.types) ã«ã¯ã“ã®ã‚ˆã†ãªè¨˜è¼‰ãŒã‚ã‚‹ã€‚

- **ãƒˆãƒªãƒ“ã‚¢ãƒ«ã‚³ãƒ”ãƒ¼å¯èƒ½ãªå‹**ã‚’æŒã¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ã€ãã‚Œã‚’æ§‹æˆã™ã‚‹ãƒã‚¤ãƒˆåˆ—ã‚’`char`ã¾ãŸã¯`unsigned char`[^3]ã®é…åˆ—ã«ã‚³ãƒ”ãƒ¼ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚`char`ã¾ãŸã¯`unsigned char`ã®é…åˆ—ã‹ã‚‰ã€ã‚³ãƒ”ãƒ¼ã•ã‚ŒãŸå†…å®¹ã‚’ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã‚³ãƒ”ãƒ¼ã—æˆ»ã—ãŸå ´åˆã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯å…ƒã®å€¤ã‚’å¾©å…ƒã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚
  - ã‚³ãƒ”ãƒ¼ã®æ–¹æ³•ã®ä¾‹ã¨ã—ã¦ã€`std::memcpy`ã‚„`std::memmove`ãŒä½¿ç”¨ã§ãã‚‹[^4]ã€‚
- ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®*object representation*ï¼ˆ**ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆè¡¨ç¾**ï¼‰ã¨ã¯ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒå æœ‰ã—ã¦ã„ã‚‹Nå€‹ã®é€£ç¶šã—ãŸ`unsigned char`å‹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã®ã“ã¨ã§ã‚ã‚‹ã€‚Nã¯ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å‹ã‚’`T`ã¨ã™ã‚‹ã¨`sizeof(T)`ã§ã‚ã‚‹ã€‚
  - `sizeof`ã¨ã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆè¡¨ç¾ãŒå æœ‰ã™ã‚‹ãƒã‚¤ãƒˆæ•°ã‚’è¿”ã™æ¼”ç®—å­ã§ã‚ã‚Šã€`sizeof(unsigned char)`ã¯1ã§ã‚ã‚‹[^sizeof]ã€‚
- ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®*value representation*ï¼ˆ**å€¤è¡¨ç¾**ï¼‰ã¨ã¯ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å‹ã®å€¤ã‚’ä¿æŒã™ã‚‹ãƒ“ãƒƒãƒˆã®é›†åˆã®ã“ã¨ã§ã‚ã‚‹ã€‚
- ãƒˆãƒªãƒ“ã‚¢ãƒ«ã‚³ãƒ”ãƒ¼å¯èƒ½ãªå‹ã«ãŠã„ã¦ã¯ã€å€¤è¡¨ç¾ã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆè¡¨ç¾ã«å«ã¾ã‚Œã‚‹ã€‚
- *value*ï¼ˆå€¤ï¼‰ã¨ã¯ã€å®Ÿè£…å®šç¾©ã§ã‚ã‚‹å€¤é›†åˆã®ä¸­ã®1ã¤ã®é›¢æ•£çš„ãªè¦ç´ ã§ã‚ã‚‹ã€‚

[^3]: å¾“ã£ã¦ã€`signed char`ãŒåŒç­‰ã«ã‚³ãƒ”ãƒ¼ã§ãã‚‹ã‹ã©ã†ã‹ã¯ä¸æ˜ã§ã‚ã‚‹ã€‚
[^4]: ã“ã®è¨˜è¿°ã¯ã€åŸæ–‡ã®[è„šæ³¨](https://timsong-cpp.github.io/cppwp/n4140/basic.types#footnote-42)ã«åŸºã¥ã„ã¦ã„ã‚‹ã€‚
[^sizeof]: https://timsong-cpp.github.io/cppwp/n4140/expr.sizeof#1

ã¤ã¾ã‚Šã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆè¡¨ç¾ï¼‰ãŒå æœ‰ã—ã¦ã„ã‚‹ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã¨ã„ã†ã®ã¯ã€1ã¤ã‚ãŸã‚Š1ãƒã‚¤ãƒˆã®`unsigned char`å‹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®é…åˆ—ã¨ã—ã¦è¦‹ãªã™ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã§ã‚ã‚‹ã€‚ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆè¡¨ç¾ï¼‰ãŒNãƒã‚¤ãƒˆãªã®ã§ã‚ã‚Œã°ã€ãã‚Œã¯`unsigned char [N]`ã¨è¦‹ãªã™ã“ã¨ãŒã§ãã‚‹[^std::byte]ã€‚

[^std::byte]: C++17ã‹ã‚‰ã¯ã€`std::byte`ãŒ`unsigned char`ã®å¼·ã„å‹ä»˜ã‘ã¨ã—ã¦å®šç¾©ã•ã‚ŒãŸã€‚`unsigned char`ã¨ãƒã‚¤ãƒˆã¯æœ¬è³ªçš„ã«åŒã˜ãªã®ã§ã‚ã‚‹ã€‚

ãã—ã¦**ãƒˆãƒªãƒ“ã‚¢ãƒ«ã‚³ãƒ”ãƒ¼å¯èƒ½ãªå‹**ã§ã‚ã‚Œã°ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒã‚¤ãƒˆåˆ—ã¯`std::memcpy`ãªã©ã«ã‚ˆã£ã¦`unsigned char`å‹ã®é…åˆ—ã«ã€å…ƒã®å€¤ã‚’å¾©å…ƒã§ãã‚‹å½¢ã§å¯é€†çš„ã«ã‚³ãƒ”ãƒ¼ãŒå¯èƒ½ã§ã‚ã‚‹ã€‚ãªãœãªã‚‰ã€ãƒˆãƒªãƒ“ã‚¢ãƒ«ã‚³ãƒ”ãƒ¼å¯èƒ½ãªå‹`T`ã®å€¤ã‚’æ±ºå®šã™ã‚‹ãƒ“ãƒƒãƒˆé›†åˆï¼ˆï¼å€¤è¡¨ç¾ï¼‰ã¯ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒå æœ‰ã™ã‚‹ãƒã‚¤ãƒˆåˆ—ï¼ˆï¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆè¡¨ç¾ï¼‰ã«å«ã¾ã‚Œã‚‹ã‹ã‚‰ã§ã‚ã‚‹ã€‚`float`ã‚„`uint32_t`ãŒãƒˆãƒªãƒ“ã‚¢ãƒ«ã‚³ãƒ”ãƒ¼å¯èƒ½ãªå‹ã§ã‚ã‚‹ã‹ã©ã†ã‹ã¯é‡è¦ãªæƒ…å ±ã§ã‚ã‚Šã€å¾Œã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ç¢ºèªã™ã‚‹ã€‚

ã•ã¦ã€**ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆè¡¨ç¾**ã¨**å€¤è¡¨ç¾**ã¨ã„ã†äºŒç¨®é¡ã®ç”¨èªãŒç™»å ´ã—ãŸã®ã§ãã®é•ã„ã‚’æ˜ç¢ºã«ã—ã‚ˆã†ã€‚ä¾‹ãˆã°ã€1ãƒã‚¤ãƒˆãŒ8bitã®ã‚·ã‚¹ãƒ†ãƒ ã«ãŠã„ã¦ã€`unsigned short`ãŒï¼ˆå­ã‚‰ã—ã„ã“ã¨ã«ï¼‰12bitã®ç²¾åº¦ã‚’æŒã¤å‹ã§ã‚ã£ãŸä»®å®šã—ã‚ˆã†ã€‚å…ˆã»ã©ã®èª¬æ˜ã‹ã‚‰ã€ã‚ã‚‰ã‚†ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯æ•´æ•°ãƒã‚¤ãƒˆã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’å æœ‰ã™ã‚‹ã®ã§ã‚ã£ãŸï¼ˆ1.5ãƒã‚¤ãƒˆã®ã¿ã®å æœ‰ã¯è¨±å®¹ã•ã‚Œãªã„ï¼‰ã€‚å¾“ã£ã¦ã€ã“ã®`unsigned short`ã‚’æ ¼ç´ã™ã‚‹ãŸã‚ã«å¿…è¦ãªã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã¯å°‘ãªãã¨ã‚‚2ãƒã‚¤ãƒˆã§ã‚ã‚Šã€å®Ÿéš›ã«2ãƒã‚¤ãƒˆã‚’å æœ‰ã™ã‚‹ã‚‚ã®ã¨ã™ã‚‹ã€‚ãã®å ´åˆã€`sizeof(unsigned short)`ã¯2ã¨ãªã‚‹ã€‚

ã“ã®å ´åˆã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆè¡¨ç¾ã¨ã¯`unsigned short`ãŒã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä¸Šã‚’å æœ‰ã—ã¦ã„ã‚‹2ãƒã‚¤ãƒˆã®ã“ã¨ã§ã‚ã‚Šã€å€¤è¡¨ç¾ã¨ã¯`unsigned short`ãŒãã®æ•´æ•°å€¤ã‚’æ±ºå®šã™ã‚‹ãŸã‚ã«å¿…è¦ãª12bitã®ã“ã¨ã§ã‚ã‚‹ã€‚ã“ã®ã‚ˆã†ã«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆè¡¨ç¾ã¨å€¤è¡¨ç¾ã¨ã§ã¯æ‰±ã£ã¦ã„ã‚‹ãƒ“ãƒƒãƒˆæ•°ã«å·®ãŒç”Ÿã˜ã‚‹ã“ã¨ãŒã‚ã‚Šã€ã“ã®å·®ã‚’ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ãƒ“ãƒƒãƒˆã¨è¨€ã†ã€‚

```cpp
unsigned short x = 0xFFF;
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ byte[1] â”‚â”‚ byte[0] â”‚ã€€<--- ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆè¡¨ç¾ã¯2byte=16bit
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 **** 1111  1111 1111   <--- å€¤è¡¨ç¾ã¯12bit (*ã‚’é™¤ã)
         8192           <--- xã®å€¤ã¯å€¤è¡¨ç¾ã‹ã‚‰æ±ºå®šã•ã‚Œã‚‹

åˆ†ã‹ã‚Šã‚„ã™ã„ã‚ˆã†ã«å³å´ã«æœ€ä¸‹ä½ãƒã‚¤ãƒˆã‚’è¨˜è¼‰ã™ã‚‹ã€‚
****ãŒãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ãƒ“ãƒƒãƒˆã§ã‚ã‚‹ã€‚
```

ãƒˆãƒªãƒ“ã‚¢ãƒ«ã‚³ãƒ”ãƒ¼ã¨ã„ã†ã®ã¯ã€æœ¬å½“ã«å¿…è¦ãªæƒ…å ±ï¼ˆå€¤è¡¨ç¾ã«é–¢ã‚ã‚‹ãƒ“ãƒƒãƒˆï¼‰ãŒã©ã“ã«ã‚ã‚‹ã®ã‹ã«ã¯å…¨ãé–¢çŸ¥ã›ãšã«ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆè¡¨ç¾ã§ã‚ã‚‹`unsigned char`ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å˜ä½ã§ç„¡å¿ƒã§ã‚³ãƒ”ãƒ¼ã™ã‚‹ã¨ã„ã†ã“ã¨ã§ã‚ã‚‹ã€‚ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ãƒ“ãƒƒãƒˆãŒã‚ã‚ã†ãŒãªã‹ã‚ã†ãŒé–¢ä¿‚ã¯ãªã„ã€‚ãƒˆãƒªãƒ“ã‚¢ãƒ«(trivial)ã¯ã€Œå–ã‚‹ã«è¶³ã‚‰ãªã„ã€ã€Œäº›ç´°ãªã€ã‚’æ„å‘³ã—[^trivial]ã€ã“ã®æ€§è³ªã‚’ã‚ˆãè¡¨ã—ã¦ã„ã‚‹ã€‚

[^trivial]: ä½™è«‡ã ãŒã€ã“ã®å˜èªã‚’ã¿ã‚‹ã¨ã€Œãƒˆãƒªãƒ“ã‚¢ã®æ³‰ã€ã‚’æ€ã„å‡ºã™ã®ã¯ç§ã ã‘ã ã‚ã†ã‹ã€‚

å®Ÿéš›ã«ã€ãã®ãƒˆãƒªãƒ“ã‚¢ãƒ«ã‚³ãƒ”ãƒ¼ã‚’ã—ã¦ãã‚Œã‚‹`std::memcpy`ã¯ä½•ã‚’ã‚„ã£ã¦ã„ã‚‹ã®ã ã‚ã†ã‹ã€‚ãã®å®£è¨€ã¯ã“ã®é€šã‚Šã§ã‚ã‚‹ã€‚

```cpp
void *memcpy(void * restrict s1, const void * restrict s2, size_t n);
```

ã“ã®ã‚ˆã†ã«ã€å—ã‘å–ã‚‹ã¨ãã®å‹ã¯`void*`ã§ã‚ã£ã¦å…ƒã®å‹ãŒä½•ã§ã‚ã£ãŸã®ã‹ã®æƒ…å ±ã¯è½ã¡ã¦ã„ã‚‹ã€‚`std::memcpy`ã‹ã‚‰ã™ã‚Œã°ã€å…ƒã€…ãŒä½•ã®å‹ã ã£ãŸã®ã‹ä¸€åˆ‡çŸ¥ã‚‹ã“ã¨ãªãã€å˜ã«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆè¡¨ç¾ã§ã‚ã‚‹ãƒã‚¤ãƒˆåˆ—ã‚’å…¨ã‚³ãƒ”ãƒ¼ã™ã‚‹ã ã‘ã§ã‚ã‚‹ã€‚

`std::memcpy`ã®ç–‘ä¼¼å®Ÿè£…ã¯ä¸‹è¨˜ã®ã‚ˆã†ãªã‚‚ã®ã¨ãªã£ã¦ãŠã‚Šã€å—ã‘å–ã£ãŸãƒã‚¤ãƒ³ã‚¿ã‚’`unsigned char*`[^20]ã¨è¦‹ãªã—ã€`unsigned char`å‹ã®é…åˆ—ã®ã‚³ãƒ”ãƒ¼ã‚’ã²ãŸã™ã‚‰è¡Œã†ã¨ã„ã†ã‚‚ã®ã¨ãªã£ã¦ã„ã‚‹ã€‚å®Ÿéš›ã«ã¯ã€å‡¦ç†ç³»ã”ã¨ã«æœ€é©åŒ–ãŒæ–½ã•ã‚Œã‚‹ã“ã¨ã«ã‚ˆã£ã¦é«˜é€ŸåŒ–ãŒæ—ã‚‰ã‚Œã¦ã„ã‚‹ã€‚

[^20]: `unsigned char*`ã«å¤‰æ›ã—ã¦ã‚ˆã„ç†ç”±ã¯å¾Œè¿°ã®ã€Œãƒã‚¤ãƒ³ã‚¿ã‚­ãƒ£ã‚¹ãƒˆã§ã¯ãƒ€ãƒ¡ãªã®ã‹ã€ã§èª¬æ˜ã—ã¦ã„ã‚‹

```cpp
void* memcpy(void* dest, const void* src, size_t n) {
    unsigned char* d = static_cast<unsigned char*>(dest);
    const unsigned char* s = static_cast<const unsigned char*>(src);
    for (size_t i = 0; i < n; ++i) {
        d[i] = s[i];
    }
    return dest;
}
```

ã•ã¦ã€ã“ã‚Œã«ã¯æ³¨æ„ãŒå¿…è¦ã§ã‚ã‚‹ã€‚ãªãœãªã‚‰ã€ä»Šå›ã¯å˜ã«`float`ã‹ã‚‰`uint32_t`ã«ãƒã‚¤ãƒˆã‚’ã‚³ãƒ”ãƒ¼ã—ãŸã„ã®ã§ã¯ãªãã€binary32ã®è¡¨ç¤ºã«å¿…è¦ãªãƒ“ãƒƒãƒˆã®ä½ç½®ã‚’ç‰¹å®šã—ã¦è«–ç†ï¼†ã§æ¼”ç®—ã‚’ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã‹ã‚‰ã ã€‚ã‚‚ã—`float`ã«ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ãƒ“ãƒƒãƒˆãŒã‚ã‚‹å ´åˆã€è¡¨ç¤ºã«ä¸è¦ãªãƒ“ãƒƒãƒˆã‚‚ã‚³ãƒ”ãƒ¼ã•ã‚Œã‚‹ã“ã¨ã‹ã‚‰ã‚³ãƒ”ãƒ¼å…ˆã®`uint32_t`ã«ãŠã„ã¦ã©ã®ãƒ“ãƒƒãƒˆãŒãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ãƒ“ãƒƒãƒˆã§ã‚ã‚‹ã‹ã‚’ç‰¹å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã€è¨ˆç®—ãŒç…©é›‘ã«ãªã‚‹ã€‚ã¾ãŸ`uint32_t`ã«ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ãƒ“ãƒƒãƒˆãŒã‚ã‚‹å ´åˆã€ãã‚‚ãã‚‚å¿…è¦ãªãƒ“ãƒƒãƒˆä½ç½®ã§è«–ç†ï¼†æ¼”ç®—ãŒã§ããªã„å¯èƒ½æ€§ãŒã§ã¦ãã‚‹ã€‚å¾“ã£ã¦ã€ä¸¡è€…ã¨ã‚‚ã«ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ãƒ“ãƒƒãƒˆãŒãªã„ã“ã¨ã‚’ç¢ºèªã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚

ã¾ãš`float`ã«ã¤ã„ã¦ã¯ã€`float`ã®ãƒã‚¤ãƒˆã‚µã‚¤ã‚ºï¼ˆ`sizeof(float)`ï¼‰ã¨ãƒã‚¤ãƒˆã‚ãŸã‚Šãƒ“ãƒƒãƒˆæ•°ï¼ˆ`CHAR_BIT`ï¼‰ã®ç©ã‹ã‚‰`float`ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ãƒ“ãƒƒãƒˆæ•°ã‚’è¨ˆç®—ã—ã€ãã‚ŒãŒ32ã¨ä¸€è‡´ã™ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ã“ã¨ã§ã€binary32ã§å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’å‰æã¨ã—ã¦ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ãƒ“ãƒƒãƒˆãŒå­˜åœ¨ã—ãªã„ã“ã¨ã‚’ä¿è¨¼ã§ãã‚‹ã€‚

```cpp
// binary32ã§å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹å ´åˆã€floatã«ã¯ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ãƒ“ãƒƒãƒˆãŒãªã„ã“ã¨ãŒä¿è¨¼ã•ã‚Œã‚‹
static_assert(sizeof(float) * CHAR_BIT == 32);
```

ã¤ãã«`uint32_t`ã§ã‚ã‚‹ãŒã€Cã®è¨€èªè¦æ ¼ã€Œ7.18.1.1 Exact-width integer typesã€ã«ãŠã„ã¦ã€`uint32_t`ã¯ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ãƒ“ãƒƒãƒˆãŒãªã„32bitç¬¦å·ç„¡ã—æ•´æ•°å‹ã§ã‚ã‚‹ã“ã¨ãŒè¦å®šã•ã‚Œã¦ã„ã‚‹[^uint32_t]ã€‚å¾“ã£ã¦ã€`uint32_t`ã«ã¤ã„ã¦ã¯ã“ã‚Œä»¥ä¸Šã«ç¢ºèªã™ã¹ãå†…å®¹ã¯ãªã„ã€‚

[^uint32_t]: ã¡ãªã¿ã«ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ãƒ“ãƒƒãƒˆãŒãªã„`uint32_t`ãŒå­˜åœ¨ã™ã‚‹ã¨ã„ã†ã“ã¨ã¯ã€1ãƒã‚¤ãƒˆãŒå°‘ãªãã¨ã‚‚32bitã®ç´„æ•°ã§ã‚ã‚‹ã“ã¨ãŒæ±ºã¾ã‚‹ã€‚å¾“ã£ã¦ã€1ãƒã‚¤ãƒˆãŒ8bitã€16bitã€32bitã®ã„ãšã‚Œã‹ã¨ãªã‚‹ãŒã€ãã®ã„ãšã‚Œã§ã‚ã‚ã†ã¨ã‚‚ä»Šå›ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§ã¯å•é¡Œã«ã¯ãªã‚‰ãªã„ã€‚

## `float`ã€`uin32_t`ã¯ãƒˆãƒªãƒ“ã‚¢ãƒ«ã‚³ãƒ”ãƒ¼å¯èƒ½ãªã®ã‹

ãã‚Œã§ã¯ã€`float`ã‚„`uint32`ãŒãƒˆãƒªãƒ“ã‚¢ãƒ«ã‚³ãƒ”ãƒ¼å¯èƒ½ãªå‹ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ã€‚

[[basic.fundamentals]](https://timsong-cpp.github.io/cppwp/n4140/basic.fundamental) ã«ã¯ã“ã®ã‚ˆã†ãªè¨˜è¼‰ãŒã‚ã‚‹ã€‚

- `signed char`ã€`short int`ã€`int`ã€`long int`ã€`long long int`ã¯*standard signed integer*ï¼ˆæ¨™æº–ç¬¦å·ä»˜ãæ•´æ•°ï¼‰å‹ã§ã‚ã‚‹ã€‚ã“ã‚Œä»¥å¤–ã«ã€å‡¦ç†ç³»å®šç¾©ã®*extended signed integer*ï¼ˆæ‹¡å¼µç¬¦å·ä»˜ãæ•´æ•°ï¼‰å‹ãŒã‚ã£ã¦ã‚‚ã‚ˆã„ã€‚ã“ã‚Œã‚‰ä¸¡è€…ã‚’åˆã‚ã›ã¦ã€*signed interger*ï¼ˆç¬¦å·ä»˜ãæ•´æ•°ï¼‰å‹ã¨å‘¼ã¶ã€‚
- `unsigned char`ã€`unsigned short int`ã€`unsigned int`ã€`unsigned long int`ã€`unsigned long long int`ã¯*standard unsigned integer*ï¼ˆæ¨™æº–ç¬¦å·ç„¡ã—æ•´æ•°ï¼‰å‹ã§ã‚ã‚‹ã€‚ã“ã‚Œä»¥å¤–ã«ã€å‡¦ç†ç³»å®šç¾©ã®*extended unsigned integer*ï¼ˆæ‹¡å¼µç¬¦å·ç„¡ã—æ•´æ•°ï¼‰å‹ãŒã‚ã£ã¦ã‚‚ã‚ˆã„ã€‚ã“ã‚Œã‚‰ä¸¡è€…ã‚’åˆã‚ã›ã¦ã€*unsigned integer*ï¼ˆç¬¦å·ç„¡ã—æ•´æ•°ï¼‰å‹ã¨å‘¼ã¶ã€‚
- ç¬¦å·ç„¡ã—æ•´æ•°å‹ã¯ã€ãã®å€¤è¡¨ç¾ã«é–¢ã‚ã‚‹ãƒ“ãƒƒãƒˆæ•°ã‚’nã¨ã—ãŸã¨ãã«$2^n$ã‚’æ³•ã¨ã—ãŸç®—è¡“æ³•å‰‡ã«å¾“ã†ã€‚
- `bool`ã€`char`ã€`char16_t`ã€`char32_t`ã€`wchar_t`ã€ç¬¦å·ä»˜ãæ•´æ•°å‹ã€ç¬¦å·ç„¡ã—æ•´æ•°å‹ã‚’åˆã‚ã›ã¦*integral*[^integral]ï¼ˆæ•´æ•°ï¼‰å‹ã¨å‘¼ã¶ã€‚
- æ•´æ•°å‹ã¯ã€"pure binary numeration system"ï¼ˆç´”ç²‹ãª2é€²æ³•ï¼‰ã¨ã—ã¦å€¤ã‚’å®šç¾©ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ã€‚ã™ãªã‚ã¡ã€2ã®è£œæ•°è¡¨ç¾ ("2's complement")ã€1ã®è£œæ•°è¡¨ç¾ ("1's complement")ã€ç¬¦å·ä»˜ãçµ¶å¯¾å€¤è¡¨ç¾ ("signed magnitude representation")ã®ã„ãšã‚Œã‹ã§ãªã‘ã‚Œã°ãªã‚‰ãªã„ã€‚
- `float`ã€`double`ã€`long double`ã¯ã€*floating point*ï¼ˆæµ®å‹•å°æ•°ç‚¹ï¼‰å‹ã§ã‚ã‚‹ã€‚
- æµ®å‹•å°æ•°ç‚¹å‹ã®å€¤è¡¨ç¾ã¯ã€å‡¦ç†ç³»å®šç¾©[^fp-imp]ã§ã‚ã‚‹ã€‚
- æ•´æ•°å‹ã¨æµ®å‹•å°æ•°ç‚¹å‹ã¯ã€*arithmetic*ï¼ˆç®—è¡“ï¼‰å‹ã§ã‚ã‚‹ã€‚

[^fp-imp]: ä»Šå›ã¯`float`ãŒbinary32ã§å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ã¨ã—ã¦è©±ã‚’é€²ã‚ã¦ã„ã‚‹ãŒã€å…¨ç„¶é•ã†å®Ÿè£…ã¯ã‚ã‚Šå¾—ã‚‹ã€‚
[^integral]: integralã¯integerã®åŒç¾©èªã§ã‚ã‚‹

`float`ã¯æµ®å‹•å°æ•°ç‚¹å‹ã§ã‚ã‚Šã€å¾“ã£ã¦ç®—è¡“å‹ã§ã‚ã‚‹ã¨ã„ã†ã“ã¨ã®ã‚ˆã†ã ã€‚ã¾ãŸã€`uint32_t`ã«ã¤ã„ã¦ã¯å…ˆã»ã©è¨€åŠã—ãŸã‚ˆã†ã«ç¬¦å·ç„¡ã—æ•´æ•°å‹ã§ã‚ã‚Šã€å¾“ã£ã¦åŒæ§˜ã«ç®—è¡“å‹ã¨ã„ã†ã“ã¨ã«ãªã‚‹ã€‚

ã“ã“ã§ã‚‚ã†ä¸€åº¦ã€[[basic.types]](https://timsong-cpp.github.io/cppwp/n4140/basic.types) ã«æˆ»ã£ã¦ã¿ã‚‹ã¨ã€æ›´ã«ã“ã®ã‚ˆã†ãªè¨˜è¼‰ãŒã‚ã‚‹ã€‚

- ç®—è¡“å‹ã€åˆ—æŒ™å‹ã€ãƒã‚¤ãƒ³ã‚¿ãƒ¼å‹ã€ãƒ¡ãƒ³ãƒã¸ã®ãƒã‚¤ãƒ³ã‚¿å‹ã€`std::nullptr_t`ã€ãã—ã¦ã“ã‚Œã‚‰ã®cvä¿®é£¾ã¯ã€ã‚ã‚ã›ã¦*scalar type*ï¼ˆã‚¹ã‚«ãƒ©ãƒ¼å‹ï¼‰ã¨å‘¼ã¶ã€‚
- CVéä¿®é£¾ã®ã‚¹ã‚«ãƒ©ãƒ¼å‹ã€ãƒˆãƒªãƒ“ã‚¢ãƒ«ã‚³ãƒ”ãƒ¼å¯èƒ½ãªã‚¯ãƒ©ã‚¹ã€ã“ã‚Œã‚‰ã®é…åˆ—ã€ã“ã‚Œã‚‰ã®évolatile[^9]ãƒ»constä¿®é£¾å‹ã¯ã€ã‚ã‚ã›ã¦*trivially copyable types*ï¼ˆãƒˆãƒªãƒ“ã‚¢ãƒ«ã‚³ãƒ”ãƒ¼å¯èƒ½ãªå‹ï¼‰ã¨å‘¼ã¶

[^9]: C++17ã‹ã‚‰ã¯évolatileã®åˆ¶ç´„ãŒãªããªã£ãŸã€‚ã¤ã¾ã‚Šã€`const volatile float`ãªã©ã‚‚ãƒˆãƒªãƒ“ã‚¢ãƒ«ã‚³ãƒ”ãƒ¼å¯èƒ½ãªå‹ã§ã‚ã‚‹ã€‚

å¾“ã£ã¦ã€`float`ã¨`uint32_t`ã¯ã„ãšã‚Œã‚‚ã‚¹ã‚«ãƒ©ãƒ¼å‹ã§ã‚ã‚Šã€ã‚ˆã£ã¦ãƒˆãƒªãƒ“ã‚¢ãƒ«ã‚³ãƒ”ãƒ¼å¯èƒ½ãªå‹ã§ã‚ã‚‹ã¨ã„ã†ã“ã¨ãŒç¢ºå®šã™ã‚‹ã€‚ã ã‹ã‚‰ã€`float`ã¨`uint32_t`ã‚’æ§‹æˆã™ã‚‹ãƒã‚¤ãƒˆåˆ—ã¯`unsigned char`å‹ã®é…åˆ—ã¨ã®é–“ã§å¯é€†çš„ã«ã‚³ãƒ”ãƒ¼ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚

```cpp
// floatã¯ãƒˆãƒªãƒ“ã‚¢ãƒ«ã‚³ãƒ”ãƒ¼å¯èƒ½ãªå‹ã§ã‚ã‚‹
float x = 1.0f;
// å¾“ã£ã¦ã€floatã¯unsigned charã®é…åˆ—ã«ã‚³ãƒ”ãƒ¼ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚
unsigned char buf[sizeof(float)];
std::memcpy(&buf, &x, sizeof(float));
```

ã•ã‚‰ã«ã€é‡è¦ãªã“ã¨ã®ä¸€ã¤ã¨ã—ã¦æ•´æ•°å‹ã«ã¤ã„ã¦ãã‚Œã‚’æ§‹æˆã™ã‚‹ãƒ“ãƒƒãƒˆåˆ—ã¨ã®å¯¾å¿œãŒè¦å®šã•ã‚Œã¦ã„ã‚‹ã€‚æ•´æ•°å‹ãŒ2é€²æ³•ã«å¾“ã£ã¦ã„ã‚‹ã“ã¨ã¯é‡è¦ã§ã‚ã‚‹ã€‚ãªãœãªã‚‰ã€ã“ã®è¨˜è¿°ã«ã‚ˆã£ã¦æ•´æ•°å‹ã®ãƒ“ãƒƒãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ãã‚ŒãŒè¡¨ã™æ•°å­—ã¨ã®é–“ã«ä¸€å¯¾ä¸€ã®é–¢ä¿‚ãŒå®šç¾©ã•ã‚Œã‚‹ã‹ã‚‰ã§ã‚ã‚‹[^unsigned]ã€‚ä»Šå›ã®ä¾‹ã§ã¯ã€`1U << i`ã®ã‚ˆã†ã«1ã¨ã„ã†æ•°å­—ã‚’å·¦è«–ç†ã‚·ãƒ•ãƒˆã™ã‚‹ã“ã¨ã§æ‰€æœ›ã®ä½ç½®ã®ãƒ“ãƒƒãƒˆã‚’è«–ç†ï¼†ã§æŠ½å‡ºã™ã‚‹ãŸã‚ã®ãƒ“ãƒƒãƒˆãƒã‚¹ã‚¯ã‚’ç”Ÿæˆã—ã¦ã„ã‚‹ãŒã€ã“ã‚Œã¯1ãŒ'0000 0001'ã®ã‚ˆã†ã«æœ€ä¸‹ä½ãƒ“ãƒƒãƒˆã ã‘1ã§ã‚ã‚‹ã‚ˆã†ãªãƒ“ãƒƒãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ã«ãªã‚‹ã“ã¨ã‚’å‰æã¨ã—ã¦ã„ã‚‹ãŸã‚ã€ã“ã®ãƒ«ãƒ¼ãƒ«ãŒå¿…è¦ã¨ãªã£ã¦ãã‚‹ã€‚

[^5]: å¾“ã£ã¦ã€`char`ã¨`signed char`ã«ã¤ã„ã¦ã¯æ•°å­—ã«å¯¾å¿œã—ãªã„ãƒ“ãƒƒãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ãŒç†è«–çš„ã«ã¯å­˜åœ¨ã—å¾—ã‚‹ã€‚
[^6]: æœ¬ç¨¿ã§ã¯ã€IEEE 754 binary32ã§è¦å®šã•ã‚ŒãŸå€¤è¡¨ç¾ã‚’æŒã¤ã‚‚ã®ã¨ã—ã¦è©±ã‚’é€²ã‚ã‚‹ã€‚
[^unsigned]: ãŸã ã—ç¬¦å·ä»˜ãæ•´æ•°å‹ã«ã¤ã„ã¦ã¯ã€ä¸Šè¿°ã®ã‚ˆã†ã«è² ã®æ•´æ•°ã®è¡¨ç¾æ–¹æ³•ã«é–¢ã—ã¦ã„ãã¤ã‹ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒã‚ã‚‹ãŸã‚ã€ä»Šå›ã®ã‚ˆã†ã«ãƒ“ãƒƒãƒˆæ“ä½œã‚’ã™ã‚‹å ´åˆã«ã¯ç¬¦å·ç„¡ã—æ•´æ•°å‹ã‚’ä½¿ã†ã»ã†ãŒæ··ä¹±ãŒé¿ã‘ã‚‰ã‚Œã¦ã‚ˆã„ã€‚

## ã¾ã¨ã‚

ä»¥ä¸Šã‚’ã¾ã¨ã‚ã‚‹ã¨ã€ã‚‚ã¨ã‚‚ã¨ã®ã‚³ãƒ¼ãƒ‰ãŒä¸Šæ‰‹ãå‹•ãç†ç”±ã¯ä¸‹è¨˜ã®ã‚ˆã†ã«ã‚³ãƒ¡ãƒ³ãƒˆã‚’ã—ãŸé€šã‚Šã«ãªã‚‹ã€‚

```cpp
#include <iostream>
#include <cstring>
#include <cstdint>
#include <climits>
#include <limits>

// binary32ã«å¾“ã†å ´åˆã«floatã®ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ãƒ“ãƒƒãƒˆãŒãªã„ã“ã¨ã‚’ç¢ºèªã™ã‚‹
static_assert(sizeof(float) * CHAR_BIT == 32);

// floatãŒIEEE 754è¦æ ¼ã«é©åˆã™ã‚‹ã“ã¨ã“ã¨ã‚’ç¢ºèªã™ã‚‹
static_assert(std::numeric_limits<float>::is_iec559);

// ä»¥ä¸‹ã®3ã¤ã«ã‚ˆã£ã¦floatãŒIEEE 754ã®ä¸­ã§ã‚‚
// ç‰¹ã«binary32ã¨ã—ã¦å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹
static_assert(std::numeric_limits<float>::digits == 24); 
static_assert(std::numeric_limits<float>::radix == 2);
static_assert(std::numeric_limits<float>::max_exponent == 128); 

int main() {
  float x = 1.0f;
  std::uint32_t buf;

  // &bufã¨&xã«ã‚ˆã£ã¦ãã‚Œãã‚Œã®æœ€åˆã®ãƒã‚¤ãƒˆã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å–å¾—ã™ã‚‹
  // floatã¨std::uint32_tã¯ãƒˆãƒªãƒ“ã‚¢ãƒ«ã‚³ãƒ”ãƒ¼å¯èƒ½ãªå‹ã§ã‚ã‚‹ãŸã‚
  // std::memcpyã«ã‚ˆã£ã¦ãƒã‚¤ãƒˆè¡¨ç¾ã‚’ãã®ã¾ã¾ãŠäº’ã„ã«ã‚³ãƒ”ãƒ¼å¯èƒ½
  std::memcpy(&buf, &x, sizeof(float));

  for (int i = 31; i >= 0; i--) {
    // è»¢å†™ã•ã‚ŒãŸbufã®å‹ã§ã‚ã‚‹std::uint32_tã¯äºŒé€²æ³•ã‚’æ¡ç”¨ã—ã¦ã„ã‚‹ãŸã‚ã€
    // ãƒ“ãƒƒãƒˆæ¼”ç®—ã«ã‚ˆã£ã¦æ‰€æœ›ã®ä½ç½®ã®ãƒ“ãƒƒãƒˆã‚’æŠ½å‡ºã§ãã‚‹ã€‚
    std::cout << ((buf & (1U << i)) ? '1' : '0'); 
    if (i == 31 || i == 23) {
        std::cout << ' ';
    }
  }
  std::cout << "\n";
}
```

ã‚ã§ãŸã—ã‚ã§ãŸã—ã€‚

## ä½•ã‹ã²ã£ã‹ã‹ã‚‰ãªã„ã ã‚ã†ã‹â€¦ï¼Ÿ

ã‚ˆãã‚ˆãè€ƒãˆã¦ã¿ã‚‹ã¨ã€ãªãœ`float`ã‹ã‚‰`uint32_t`ã«ãƒã‚¤ãƒˆã‚³ãƒ”ãƒ¼ãŒã§ããŸã®ã ã‚ã†ã‹ã€‚å…ˆã»ã©ã¾ã§ã®èª¬æ˜ã§ç´å¾—ã—ã¦ã„ã‚Œã°ãã‚Œã§ã‚‚ã‚ˆã„ãŒã€ã“ã“ã¾ã§è¨€åŠã—ãŸå›½éš›æ¨™æº–è¦æ ¼ã®å†…å®¹ã‚’å³å¯†ã«è§£é‡ˆã™ã‚Œã°ã€ãƒˆãƒªãƒ“ã‚¢ãƒ«ã‚³ãƒ”ãƒ¼å¯èƒ½ãªå‹ã¨`unsigned char`ã®é…åˆ—ã¨ã®é–“ã§å¯é€†çš„ã«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆè¡¨ç¾ã®ã‚³ãƒ”ãƒ¼ãŒã§ãã‚‹ã¨è¨€ã£ã¦ã„ã‚‹ã ã‘ã§ã€**ä»»æ„ã®ç•°ãªã‚‹ãƒˆãƒªãƒ“ã‚¢ãƒ«ã‚³ãƒ”ãƒ¼å¯èƒ½ãªå‹**ã®é–“ã§å¯é€†çš„ã«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆè¡¨ç¾ã®ã‚³ãƒ”ãƒ¼ãŒã§ãã‚‹ã¨ã¾ã§ã¯è¨€ã£ã¦ã„ãªã„ã‚ˆã†ã«è¦‹ãˆã‚‹ã€‚

```cpp
  float x = 1.0f;
  std::uint32_t buf;
  static_assert(sizeof(float) == sizeof(std::uint32_t));
  std::memcpy(&buf, &x, sizeof(float)); // æœ¬å½“ã«OK?
```

ã©ã†ã‚„ã‚‰ã€è‡ªåˆ†ã¨åŒã˜ã‚ˆã†ãªç–‘å•ã‚’æŒã£ã¦ã„ã‚‹äººã‚‚ã„ã‚‹ã‚ˆã†ã§ã‚ã‚‹ã€‚

https://stackoverflow.com/questions/51300626/is-stdmemcpy-between-different-trivially-copyable-types-undefined-behavior

ã“ã‚Œã«ã¤ã„ã¦ã€è‡ªåˆ†ãŒèª¿ã¹ãŸé™ã‚Šã§ã¯å›½éš›æ¨™æº–è¦æ ¼ã¯ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆã«ç­”ãˆã‚’è¿°ã¹ã¦ã„ãªã„ã‚ˆã†ã«è¦‹ãˆã‚‹ã€‚å…ˆã»ã©ã®`std::memcpy`ã®ä»•æ§˜ã«è¸ã¿è¾¼ã‚€ã“ã¨ã§åˆã‚ã¦ã“ã®ã‚ˆã†ãªæ“ä½œã‚‚èªã‚ã‚‰ã‚Œã‚‹ã¨è§£é‡ˆã™ã‚‹ã¨ã„ã†ã“ã¨ã ã‚ã†ã‹ã€‚ã¾ãŸã€ãã‚‚ãã‚‚ã“ã‚ŒãŒèªã‚ã‚‰ã‚Œãªã‘ã‚Œã°ä½ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ãŒä¸å¯èƒ½ã«ãªã‚‹ã§ã‚ã‚ã†ã‹ã‚‰ã€ã“ã‚Œã¾ã§ã®æ…£ç¿’ã‚‚å«ã‚ã¦æš—é»™çš„ã«èªã‚ã‚‰ã‚Œã¦ã„ã‚‹ã¨ã„ã†ã“ã¨ãªã®ã ã‚ã†ã¨è§£é‡ˆã™ã‚‹ã“ã¨ã«ã™ã‚‹ã€‚

## ãã®ä»–ã®æ–¹æ³•ã«ã¤ã„ã¦

ä¸Šè¨˜ã§ç´¹ä»‹ã—ãŸã‚‚ã®ä»¥å¤–ã«ã€ãŸã¨ãˆã°`unsigned int`ã‚„`unsigned char []`ã¸ã®ã‚³ãƒ”ãƒ¼ã€ã‚‚ã—ãã¯ã‚³ãƒ”ãƒ¼ã§ã¯ãªããƒã‚¤ãƒ³ã‚¿ã®ã‚­ãƒ£ã‚¹ãƒˆã«ã‚ˆã£ã¦`float`ã®ãƒ“ãƒƒãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’åˆ¥ã®æ•´æ•°å‹ã¨ã—ã¦ç›´æ¥å‚ç…§ã™ã‚‹æ–¹æ³•ãªã©ãŒè€ƒãˆã‚‰ã‚Œã‚‹ã€‚ã“ã‚Œã‚‰ã®æ‰‹æ³•ã‚’æ¡ç”¨ã™ã‚‹éš›ã«ã€æ³¨æ„ã™ã¹ãã“ã¨ã‚’ä»¥ä¸‹ã«æŒ™ã’ã‚‹ã€‚

### `unsigned int`ã‚’ã‚³ãƒ”ãƒ¼å…ˆã¨ã™ã‚‹å ´åˆ

ã¾ãš`unsigned int`ã‚’æ§‹æˆã™ã‚‹ãƒ“ãƒƒãƒˆæ•°ãŒ32ãƒ“ãƒƒãƒˆã§ã‚ã‚Œã°[^9]ã€`float`ãŒä½™åˆ†ãªã‚¹ãƒšãƒ¼ã‚¹ç„¡ã—ã§ã‚³ãƒ”ãƒ¼ã§ãã‚‹ã“ã¨ãŒä¿è¨¼ã•ã‚Œã‚‹ã€‚

[^9]: ã“ã‚Œã¯ç†è«–çš„ãªè©±ã§ã¯ãªãã€å®Ÿéš›ã®è©±ã¨ã—ã¦`int`ã¯32bitã¨ã¯é™ã‚‰ãšã€å‡¦ç†ç³»ã«ã‚ˆã£ã¦16bitã ã£ãŸã‚Š64bitã§ã‚ã‚‹ã“ã¨ã¯ååˆ†ã‚ã‚‹è©±ã§ã‚ã‚‹ã€‚

```cpp
static_assert(sizeof(unsigned int) * CHAR_BIT == 32);
float x = 1.0f;
unsigned int buf;
std::memcpy(&buf, &float, sizeof(x));
```

ã—ã‹ã—ãªãŒã‚‰ã€ã“ã‚Œã§ã¯ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ãƒ“ãƒƒãƒˆã‚’å«ã‚“ã§ã„ã‚‹å¯èƒ½æ€§ã‚’æ’é™¤ã§ãã¦ãŠã‚‰ãšã€å¾Œã®ãƒ“ãƒƒãƒˆæ¼”ç®—æ™‚ã«ç²¾åº¦ä¸è¶³ã«ã‚ˆã£ã¦æœŸå¾…ã—ãªã„çµæœã‚’ã‚‚ãŸã‚‰ã™å¯èƒ½æ€§ãŒã‚ã‚‹ã€‚å³å¯†ã«ã¯`unsigned int`ãŒ32ãƒ“ãƒƒãƒˆã®æ•°å€¤ã‚’ã™ã¹ã¦è¡¨ç¾ã§ãã‚‹ã“ã¨ã‚’åˆ¥é€”ç¢ºã‹ã‚ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚

ä¸€ä¾‹ã¨ã—ã¦ã€unsigned intã®æœ€å¤§å€¤ãŒ2^32-1=4294967295ã§ã‚ã‚‹ã“ã¨ã‚’`UINT_MAX`ãªã©ã§ç¢ºã‹ã‚ã‚Œã°å¤§æŠµã®å ´åˆã¯ã‚ˆã„ã§ã‚ã‚ã†ã€‚

```cpp
static_assert(UINT_MAX == 4294967295); // ã“ã‚Œã§æœ¬å½“ã«è‰¯ã„ï¼Ÿ
```

**ã—ã‹ã—ãªãŒã‚‰**ã€ã“ã‚Œã¯å‡¦ç†ç³»ãŒ`4294967295`ã‚’è¡¨ç¾ã§ãã‚‹æ•´æ•°å‹ã‚’æŒã£ã¦ã„ã‚‹å ´åˆã«é™ã‚‰ã‚Œã‚‹ãŸã‚ï¼ˆãŸã¨ãˆã°`unsigned long long`ã§ã•ãˆã‚‚16bitãªã‚·ã‚¹ãƒ†ãƒ ãŒã‚ã‚‹ã‹ã‚‚ã—ã‚Œãªã„ï¼‰ã€å³å¯†ã•ã‚’æœŸã™ã®ã§ã‚ã‚Œã°`UINT_MAX`ã‚’1å³ã‚·ãƒ•ãƒˆæ¼”ç®—ã—ã¦ã„ã£ã¦1ãŒä½•ãƒ“ãƒƒãƒˆç«‹ã£ã¦ã„ã‚‹ã®ã‹è¨ˆæ¸¬ã™ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’çµ„ã‚€ã®ãŒã‚ˆã„ã§ã‚ã‚ã†ã€‚è©³ç´°ã¯CERTã®[INT35-C](https://www.jpcert.or.jp/sc-rules/c-int35-c.html)ã‚’å‚ç…§ã•ã‚ŒãŸã„ã€‚

### `unsigned char`ã®é…åˆ—ã‚’ã‚³ãƒ”ãƒ¼å…ˆã¨ã™ã‚‹å ´åˆ

[[basic.fundamental]](https://timsong-cpp.github.io/cppwp/n4140/basic.fundamental)ã«è¨˜è¼‰ãŒã‚ã‚‹ãŒã€`unsigned char`ã¯ãƒŠãƒ­ãƒ¼æ–‡å­—å‹ã§ã‚ã‚Šã€å…¨ã¦ã®ãƒ“ãƒƒãƒˆãŒå€¤è¡¨ç¾ã«é–¢ã‚ã£ã¦ã„ã‚‹ã“ã¨ãŒå®šã‚ã‚‰ã‚Œã¦ã„ã‚‹ã€‚å¾“ã£ã¦ã€è¿½åŠ ã§ç¢ºèªã™ã‚‹å†…å®¹ã¯ãªã„ã€‚ãŸã ã—ã€å¾Œè¿°ã®ã‚¨ãƒ³ãƒ‡ã‚£ã‚¢ãƒ³ã®å•é¡Œã«ã¤ã„ã¦ã¯å¯¾å¿œã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚

### `std::memcpy`ã§ã¯ãªããƒã‚¤ãƒ³ã‚¿ã‚­ãƒ£ã‚¹ãƒˆã«ã‚ˆã‚‹å ´åˆ

ã“ã®æ‰‹ã®å‡¦ç†ã‚’ã™ã‚‹ã¨ãã«ã€`std::memcpy`ã«ã‚ˆã‚‹ã‚³ãƒ”ãƒ¼ã‚’ä»‹ã•ãšã«ã€`float`ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’`uint32_t`ã¸ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨è¦‹ãªã—ã¦é€†å‚ç…§ã‚’ã™ã‚‹ã“ã¨ã§ã€ç›´æ¥çš„ã«å¤‰æ›ã™ã‚‹æ–¹æ³•ãŒæ€ã„ã¤ãã€‚

```cpp
static_assert(sizeof(float) * CHAR_BIT == 32);
float x = 1.0f;
uint32_t y = *((uint32_t *)(&x)); // Undefined behavior!
```

**ã—ã‹ã—ãªãŒã‚‰**ã€ã“ã‚Œã¯æœªå®šç¾©å‹•ä½œã§ã‚ã‚‹ã€‚ãªãœãªã‚‰ã€C++ã®è¦æ ¼ã«ã‚ˆã‚Œã°ã€Œãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒæŒã¤å€¤ã‚’ã€ä»¥ä¸‹ã®å‹ã‚’é™¤ãglvalue[^glvalue]ã‚’é€šã—ã¦ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹å ´åˆã®å‹•ä½œã¯æœªå®šç¾©ã§ã‚ã‚‹ã€[^strict-aliasing]ã¨ã—ã¦ã„ã‚‹ã‹ã‚‰ã§ã‚ã‚‹ã€‚

[^glvalue]: ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å‚ç…§ã™ã‚‹å¼(expression)ã®ã“ã¨ã€‚ã“ã“ã§ã¯ã€`*((uint32_t *)(&x))`ãŒ`x`ã¨ã„ã†ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å‚ç…§ã™ã‚‹`uint32_t`å‹ã®glvalueã§ã‚ã‚Šã€ã“ã‚ŒãŒ`x`ã®å‹ã§ã‚ã‚‹`float`ã¨é©åˆã—ãªã„å‹ã§ã‚ã‚‹ãŸã‚ã€strict type aliasingã«é•åã™ã‚‹ã¨ã„ã†ã“ã¨ã§ã‚ã‚‹
[^strict-aliasing]: https://timsong-cpp.github.io/cppwp/n4140/basic.lval#10

ã€Œä»¥ä¸‹ã®å‹ã€ã¨ã¯ã€
- ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å‹•çš„å‹(dynamic type)[^dynamic_type]
...ï¼ˆç•¥ï¼‰...
- å‹•çš„å‹ã®ãƒ™ãƒ¼ã‚¹ã‚¯ãƒ©ã‚¹å‹[^base_class]
- `char`å‹ã¾ãŸã¯`unsigned char`å‹

[^dynamic_type]: è©±ãŒã‚„ã‚„ã“ã—ã„ãŒã€C++ã®è¦æ ¼ã«ã‚ˆã‚‹å®šç¾©ã¯[ã“ã®é€šã‚Š](https://timsong-cpp.github.io/cppwp/n4140/defns.dynamic.type#type,dynamic)ã§ã‚ã‚Šã€glvalueãŒå‚ç…§ã—ã¦ã„ã‚‹*most derived object*ã®å‹ã®ã“ã¨ã§ã‚ã‚‹ã€‚*most dervived object*ã¨ã¯[ã“ã“](https://timsong-cpp.github.io/cppwp/n4140/intro.object#4)ã«å®šç¾©ã•ã‚Œã¦ã„ã‚‹ãŒã€`class`/`struct`/`union`ã§ãªã„å‹ã¯å…¨ã¦*most derived object*ã§ã‚ã‚‹ã€‚å¾“ã£ã¦ã€`float`ã¯å‹•çš„å‹ã§ã‚ã‚‹ã€‚
[^base_class]: æœ¬ç¨¿ã¨ã¯é–¢ä¿‚ã¯ãªã„ãŒã€ã“ã®ä¾‹å¤–ã«ã‚ˆã£ã¦ã‚¯ãƒ©ã‚¹ã«ãŠã„ã¦ã¯ãƒãƒªãƒ¢ãƒ¼ãƒ•ã‚£ã‚ºãƒ ãŒå®Ÿç¾ã§ãã‚‹

ã§ã‚ã‚‹ã€‚ä»Šå›ã®ä¾‹ã§ã¯ã€`float`ã®å‹•çš„å‹ã¯`float`ã§ã‚ã‚Š[^dynamic_type]ã€`float`ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ä»–ã®å‹ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨å†è§£é‡ˆã—ã¦é€†å‚ç…§ã™ã‚‹ã“ã¨ã¯ãƒ€ãƒ¡ã¨ã„ã†ã“ã¨ã§ã‚ã‚‹ã€‚ã“ã‚Œã¯ä¸€èˆ¬ã«"strict aliasing rule"ã¨å‘¼ã°ã‚Œã‚‹ã‚‚ã®ã§ã€CERTã®[EXP39-C](https://www.jpcert.or.jp/sc-rules/c-exp39-c.html)ã«ã‚‚è¨˜è¼‰ãŒã‚ã‚‹ã€‚è©³ã—ãã¯ã€[^yoh][^gununu]ãªã©ã§è©³ã—ãè§£èª¬ã•ã‚Œã¦ã„ã‚‹ãŒã€å¹³ãŸãã„ãˆã°ã€Œãã‚“ãªå¤‰ãªã“ã¨ã¯ã—ãªã„ã“ã¨ã‚’ä»®å®šã™ã‚‹ã“ã¨ã§ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã‚’æœ€é©åŒ–ã—ãŸã„ã€ã¨ã„ã†ã®ãŒç†ç”±ã§ã‚ã‚‹ã€‚

[^yoh]: https://yohhoy.hatenadiary.jp/entry/20120220/p1
[^gununu]: https://gununu.hatenadiary.jp/entry/20150201/1422769062

ã—ã‹ã—ãªãŒã‚‰ã€ä¸Šè¿°ã®ã‚ˆã†ã«`unsigned char`ã¯ä¾‹å¤–ã§ã‚ã‚‹ã€‚å¾“ã£ã¦ã€`unsigned char *`ã¨è¦‹ãªã—ã¦ãã‚Œã‚’é…åˆ—ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã‚ˆã†ã«æ‰‹æ³•ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šå•é¡Œã‚’è§£æ¶ˆã§ãã‚‹ã€‚ï¼ˆãã‚‚ãã‚‚ã“ã‚Œã¯ã€`std::memcpy`ãŒã‚„ã£ã¦ã„ã‚‹ã“ã¨ã¨åŒã˜ã§ã‚ã‚‹ã€‚ï¼‰

ãŸã ã—ã“ã®å ´åˆã‚‚ã€ã‚¨ãƒ³ãƒ‡ã‚£ã‚¢ãƒ³ã®å•é¡ŒãŒã‚ã‚‹ãŸã‚å¾Œè¿°ã®å¯¾å¿œãŒå¿…è¦ã¨ãªã‚‹ã€‚

```cpp
static_assert(sizeof(float) * CHAR_BIT == 32);
float x = 1.0f;
unsigned char * buf = (unsigned char *)(&x);
for (int i = 0; i < sizeof(x); i++) {
  // buf[i]ã«ã‚¢ã‚¯ã‚»ã‚¹
}
```

#### è£œè¶³

â€¦ã¨æ›¸ã„ã¦ãŠã„ã¦ã‚ã‚Œã ãŒã€C++17ã§ã¯ã“ã‚Œã¯æœªå®šç¾©å‹•ä½œã«ãªã‚‹ã‚ˆã†ãªå¤‰æ›´ã‚’ã—ã¦ã—ã¾ã£ãŸã¨ã‹ãªã‚“ã¨ã‹ã§ã€æ”¹å–„ææ¡ˆãŒè¡Œã‚ã‚Œã¦ã„ã‚‹ã¨ã®ã“ã¨ã€‚å°‘ãªãã¨ã‚‚C++29ä»¥é™ã«ãªã‚Šãã†ã§ã€ãƒã‚¸ã§è¨€ã£ã¦ã„ã‚‹ã®ã‹ã¨ã„ã†æ„Ÿã˜ã€‚

https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2025/p1839r7.html

https://github.com/cplusplus/papers/issues/592

### ã‚¨ãƒ³ãƒ‡ã‚£ã‚¢ãƒ³ã«ã¤ã„ã¦

`unsigned char`ã®é…åˆ—ã‚’ã‚³ãƒ”ãƒ¼å…ˆã«ç”¨ã„ã¦ãƒ“ãƒƒãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è¡¨ç¤ºã™ã‚‹æ–¹æ³•ã‚’å–ã‚‹å ´åˆã€å…ƒã®`float`ã®æœ€ä¸Šä½ãƒã‚¤ãƒˆãŒé…åˆ—ã®æœ€åˆã«æ¥ã‚‹ã®ã‹ã€æœ€å¾Œã«æ¥ã‚‹ã®ã‹ã‚’æ±ºå®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚ã“ã‚Œã¯ã‚¨ãƒ³ãƒ‡ã‚£ã‚¢ãƒ³ã€ãªã„ã—ã¯ãƒã‚¤ãƒˆã‚ªãƒ¼ãƒ€ãƒ¼ã¨å‘¼ã°ã‚Œã‚‹é¡ã®å•é¡Œã§ã‚ã‚‹[^endian]ã€‚x86-64ã§ã¯ãƒªãƒˆãƒ«ã‚¨ãƒ³ãƒ‡ã‚£ã‚¢ãƒ³ã§ã‚ã‚‹ãŒã€ä»–ã®å‡¦ç†ç³»ã§ã¯ãƒ“ãƒƒã‚°ã‚¨ãƒ³ãƒ‡ã‚£ã‚¢ãƒ³ã‚’æ¡ç”¨ã—ã¦ã„ã‚‹ã‚‚ã®ã‚‚ã‚ã‚‹ã€‚

[^endian]: https://ja.wikipedia.org/wiki/%E3%82%A8%E3%83%B3%E3%83%87%E3%82%A3%E3%82%A2%E3%83%B3

ã“ã‚Œã«å¯¾å¿œã™ã‚‹ãŸã‚ã«ã¯ã€ä¾‹ãˆã°2ãƒã‚¤ãƒˆä»¥ä¸Šã®æ•´æ•°å‹ã§1ã‚’æ ¼ç´ã—ãŸå¤‰æ•°ã‚’å®šç¾©ã—ã€ãã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’`char *`ãªã„ã—ã¯`unsigned char *`ã«å¤‰æ›ã—ãŸéš›ã«ã€æœ€åˆã®ãƒã‚¤ãƒˆãŒ1ã¨è§£é‡ˆã•ã‚Œã‚‹ã‹ã©ã†ã‹ã§æ±ºå®šã§ãã‚‹ã€‚æœ€åˆã®ãƒã‚¤ãƒˆãŒ1ã§ã‚ã‚Œã°ãƒªãƒˆãƒ«ã‚¨ãƒ³ãƒ‡ã‚£ã‚¢ãƒ³ã€æœ€å¾Œã®ãƒã‚¤ãƒˆãŒ1ã§ã‚ã‚Œã°ãƒ“ãƒƒã‚°ã‚¨ãƒ³ãƒ‡ã‚£ã‚¢ãƒ³ã§ã‚ã‚‹[^other_endian]ã€‚å¾“ã£ã¦ã€ä¸‹è¨˜ã®ã‚ˆã†ãªé–¢æ•°ã‚’ç”¨æ„ã™ã‚Œã°ã‚ˆã„ã€‚ãªãŠã€C++20ä»¥é™ã§ã‚ã‚Œã°[std::endian](https://cpprefjp.github.io/reference/bit/endian.html)ã«ã‚ˆã£ã¦æ±ºå®šã§ãã‚‹ã€‚

[^other_endian]: è«–ç†çš„ã«ã¯ãƒªãƒˆãƒ«ã‚¨ãƒ³ãƒ‡ã‚£ã‚¢ãƒ³ã§ã‚‚ãƒ“ãƒƒã‚°ã‚¨ãƒ³ãƒ‡ã‚£ã‚¢ãƒ³ã§ã‚‚ãªã„ç’°å¢ƒãŒå­˜åœ¨ã—å¾—ã‚‹ãŒã€ç¾çŠ¶ã§ã¯ã»ã¨ã‚“ã©è¦‹ã‹ã‘ãªã„ãŸã‚æœ¬ç¨¿ã§ã¯ç„¡è¦–ã™ã‚‹ã€‚

```cpp
bool is_little_endian() {
    static_assert(sizeof(int) > 1);
    int x = 1;
    return *reinterpret_cast<char *>(&x) == 1;
}
```

ã‚ã¨ã¯ã€ã‚¨ãƒ³ãƒ‡ã‚£ã‚¢ãƒ³ã«å¾“ã£ã¦ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¹ãé…åˆ—ä½ç½®ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ã“ã¨ã§å•é¡Œã«å¯¾å‡¦ã§ãã‚‹ã€‚ï¼ˆ[å®Ÿè¡Œçµæœ][result2])

```cpp
#include <iostream>
#include <cstring>
#include <cstdint>
#include <climits>
#include <limits>

static_assert(sizeof(float) * CHAR_BIT == 32);
static_assert(std::numeric_limits<float>::is_iec559);
static_assert(std::numeric_limits<float>::digits == 24);
static_assert(std::numeric_limits<float>::radix == 2);
static_assert(std::numeric_limits<float>::max_exponent == 128);

bool is_little_endian() {
    static_assert(sizeof(int) > 1);
    int x = 1;
    return *reinterpret_cast<char*>(&x) == 1;
}

int main() {
  float x = 1.0f;
  unsigned char * bytes = reinterpret_cast<unsigned char *>(&x);
  static_assert(sizeof(float) == 4);
  static_assert(CHAR_BIT == 8);

  bool little_endian = is_little_endian();
  for (int i = 31; i >= 0; i--) {
    unsigned char byte = little_endian ? bytes[i / 8] : bytes[3 - i / 8];
    std::cout << (byte & (1U << (i % 8)) ? '1' : '0');
    if (i == 31 || i == 23) {
        std::cout << ' ';
    }
  }
  std::cout << '\n';
}
```

ã‚¨ãƒ³ãƒ‡ã‚£ã‚¢ãƒ³å•é¡Œã«æ­£ã—ãå¯¾å‡¦ã§ãã¦ã„ã‚‹ã‹ã©ã†ã‹ã¯ã€ç•°ãªã‚‹ã‚¨ãƒ³ãƒ‡ã‚£ã‚¢ãƒ³ã‚’æŒã¤ã‚·ã‚¹ãƒ†ãƒ ãªã„ã—ã¯ãã®ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã§ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ãƒ“ãƒ«ãƒ‰ãƒ»å®Ÿè¡Œã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚Linux (Ubuntu)ã§ã‚ã‚Œã°ã€ä¸‹è¨˜ã®ã‚ˆã†ã«QEMUã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€x86-64 (ãƒªãƒˆãƒ«ã‚¨ãƒ³ãƒ‡ã‚£ã‚¢ãƒ³ï¼‰ã¨MIPSï¼ˆãƒ“ãƒƒã‚°ã‚¨ãƒ³ãƒ‡ã‚£ã‚¢ãƒ³ï¼‰ã®ä¸¡æ–¹ã‚’ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚

```sh
# x86-64ã§ã®å®Ÿè¡Œ
x86_64-linux-gnu-g++ test.cpp && qemu-x86_64 ./a.out
# MIPSã§ã®å®Ÿè¡Œ
mips-linux-gnu-g++ -static test.cpp && qemu-mips ./a.out
```

ä¸¡æ–¹ã®ã‚¨ãƒ³ãƒ‡ã‚£ã‚¢ãƒ³ã«å¯¾å¿œã—ãŸãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§ã‚ã‚Œã°ã€å®Ÿè¡Œçµæœã¯åŒã˜ã¨ãªã‚‹ã€‚

```sh
0 01111111 00000000000000000000000
0 01111111 00000000000000000000000
```

### C++20ã§ã‚ã‚Œã°â€¦

[std::bit_cast](https://cpprefjp.github.io/reference/bit/bit_cast.html)ã‚’`std::memcpy`ã®ä»£ã‚ã‚Šã«ä½¿ç”¨å¯èƒ½ã§ã‚ã‚‹ã€‚ãƒã‚¤ãƒˆã‚µã‚¤ã‚ºãŒä¸€è‡´ã™ã‚‹ã“ã¨ã‚’ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åˆ¶ç´„ã§ä¿è¨¼ã—ã¦ãã‚Œã‚‹ãŸã‚ã€ä½¿ã„å‹æ‰‹ãŒå°‘ã—ã„ã„ã€‚å…¥å‡ºåŠ›ã®å‹ãŒãƒˆãƒªãƒ“ã‚¢ãƒ«ã‚³ãƒ”ãƒ¼å¯èƒ½ãªå‹ã§ãªã‘ã‚Œã°ã„ã‘ãªã„ã¨ã„ã†äº‹æƒ…ã¯åŒã˜ã§ã‚ã‚‹ãŸã‚ã€`std::memcpy`ã‚’ç°¡ç•¥åŒ–ã—ãŸã‚‚ã®ã ã¨æ‰ãˆã‚‹ã¨ã‚ˆã„ã€‚

```cpp
  float x = 1.0f;

  // before C++20
  std::uint32_t buf;
  std::memcpy(&buf, &x, sizeof(float));

  // From C++20
  const std::uint32_t buf = bit_cast<std::uint32_t>(x);
```

[result]: https://godbolt.org/#g:!((g:!((g:!((h:codeEditor,i:(filename:'1',fontScale:14,fontUsePx:'0',j:1,lang:c%2B%2B,selection:(endColumn:1,endLineNumber:25,positionColumn:1,positionLineNumber:25,selectionStartColumn:1,selectionStartLineNumber:25,startColumn:1,startLineNumber:25),source:'%23include+%3Ciostream%3E%0A%23include+%3Ccstring%3E%0A%23include+%3Ccstdint%3E%0A%23include+%3Cclimits%3E%0A%23include+%3Climits%3E%0A%0Astatic_assert(sizeof(float)+*+CHAR_BIT+%3D%3D+32)%3B%0Astatic_assert(std::numeric_limits%3Cfloat%3E::is_iec559)%3B%0Astatic_assert(std::numeric_limits%3Cfloat%3E::digits+%3D%3D+24)%3B%0Astatic_assert(std::numeric_limits%3Cfloat%3E::radix+%3D%3D+2)%3B%0Astatic_assert(std::numeric_limits%3Cfloat%3E::max_exponent+%3D%3D+128)%3B%0A%0Aint+main()+%7B%0A++float+x+%3D+1.0f%3B%0A++std::uint32_t+buf%3B%0A++std::memcpy(%26buf,+%26x,+sizeof(float))%3B%0A++for+(int+i+%3D+31%3B+i+%3E%3D+0%3B+i--)+%7B%0A++++std::cout+%3C%3C+((buf+%26+(1U+%3C%3C+i))+%3F+!'1!'+:+!'0!')%3B%0A++++if+(i+%3D%3D+31+%7C%7C+i+%3D%3D+23)+%7B%0A++++++++std::cout+%3C%3C+!'+!'%3B%0A++++%7D%0A++%7D%0A++std::cout+%3C%3C+%22%5Cn%22%3B%0A%7D%0A'),l:'5',n:'0',o:'C%2B%2B+source+%231',t:'0')),k:50,l:'4',n:'0',o:'',s:0,t:'0'),(g:!((h:executor,i:(argsPanelShown:'1',compilationPanelShown:'0',compiler:g151,compilerName:'',compilerOutShown:'0',execArgs:'',execStdin:'',fontScale:14,fontUsePx:'0',j:1,lang:c%2B%2B,libs:!(),options:'-std%3Dc%2B%2B14',overrides:!(),runtimeTools:!(),source:1,stdinPanelShown:'1',tree:0,wrap:'1'),l:'5',n:'0',o:'Executor+x86-64+gcc+15.1+(C%2B%2B,+Editor+%231)',t:'0')),k:50,l:'4',n:'0',o:'',s:0,t:'0')),l:'2',n:'0',o:'',t:'0')),version:4

[result2]: https://godbolt.org/#g:!((g:!((g:!((h:codeEditor,i:(filename:'1',fontScale:14,fontUsePx:'0',j:1,lang:c%2B%2B,selection:(endColumn:2,endLineNumber:34,positionColumn:1,positionLineNumber:1,selectionStartColumn:2,selectionStartLineNumber:34,startColumn:1,startLineNumber:1),source:'%23include+%3Ciostream%3E%0A%23include+%3Ccstring%3E%0A%23include+%3Ccstdint%3E%0A%23include+%3Cclimits%3E%0A%23include+%3Climits%3E%0A%0Astatic_assert(sizeof(float)+*+CHAR_BIT+%3D%3D+32)%3B%0Astatic_assert(std::numeric_limits%3Cfloat%3E::is_iec559)%3B%0Astatic_assert(std::numeric_limits%3Cfloat%3E::digits+%3D%3D+24)%3B%0Astatic_assert(std::numeric_limits%3Cfloat%3E::radix+%3D%3D+2)%3B%0Astatic_assert(std::numeric_limits%3Cfloat%3E::max_exponent+%3D%3D+128)%3B%0A%0Abool+is_little_endian()+%7B%0A++++static_assert(sizeof(int)+%3E+1)%3B%0A++++int+x+%3D+1%3B%0A++++return+*reinterpret_cast%3Cchar*%3E(%26x)+%3D%3D+1%3B%0A%7D%0A%0Aint+main()+%7B%0A++float+x+%3D+1.0f%3B%0A++unsigned+char+*+bytes+%3D+reinterpret_cast%3Cunsigned+char+*%3E(%26x)%3B%0A++static_assert(sizeof(float)+%3D%3D+4)%3B%0A++static_assert(CHAR_BIT+%3D%3D+8)%3B%0A%0A++bool+little_endian+%3D+is_little_endian()%3B%0A++for+(int+i+%3D+31%3B+i+%3E%3D+0%3B+i--)+%7B%0A++++unsigned+char+byte+%3D+little_endian+%3F+bytes%5Bi+/+8%5D+:+bytes%5B3+-+i+/+8%5D%3B%0A++++std::cout+%3C%3C+(byte+%26+(1U+%3C%3C+(i+%25+8))+%3F+!'1!'+:+!'0!')%3B%0A++++if+(i+%3D%3D+31+%7C%7C+i+%3D%3D+23)+%7B%0A++++++++std::cout+%3C%3C+!'+!'%3B%0A++++%7D%0A++%7D%0A++std::cout+%3C%3C+!'%5Cn!'%3B%0A%7D'),l:'5',n:'0',o:'C%2B%2B+source+%231',t:'0')),k:50,l:'4',n:'0',o:'',s:0,t:'0'),(g:!((h:executor,i:(argsPanelShown:'1',compilationPanelShown:'0',compiler:g151,compilerName:'',compilerOutShown:'0',execArgs:'',execStdin:'',fontScale:14,fontUsePx:'0',j:1,lang:c%2B%2B,libs:!(),options:'-std%3Dc%2B%2B14',overrides:!(),runtimeTools:!(),source:1,stdinPanelShown:'1',tree:0,wrap:'1'),l:'5',n:'0',o:'Executor+x86-64+gcc+15.1+(C%2B%2B,+Editor+%231)',t:'0')),k:50,l:'4',n:'0',o:'',s:0,t:'0')),l:'2',n:'0',o:'',t:'0')),version:4